{% load static attrs %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Hotel Voucher</title>
  <style>
    @page { size: A4; margin: 12mm; }
    body { font-family: DejaVu Sans, Arial, sans-serif; font-size: 12px; color:#222; }
    .wrap { border:1px solid #000; padding:12px; }
    .head { text-align:center; border-bottom:1px solid #000; padding-bottom:8px; margin-bottom:10px; }
    .brand { color:#c00; font-weight:bold; font-size:16px; margin:0 0 4px }
    .logo { float:right; width: 90px; }
    .qr { float:left; width: 70px; border:1px solid #000; padding:2px; }
    .st { background:#e6f2ff; border-right:4px solid #007bff; padding:6px 8px; font-weight:bold; margin:10px 0 6px }
    table { width:100%; border-collapse:collapse; }
    th { text-align:right; width: 180px; vertical-align:top; padding:4px 6px; }
    td { border:1px solid #000; padding:6px 8px; vertical-align:top; }
    .full td { width:100% }
    .gcard { border:1px solid #000; padding:6px; margin:6px 0 }
    .clr { clear: both; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- لو عندك لوجو في static/ -->
    <img src="{% static 'logo.png' %}" class="logo" />
    {% if qr_data_url %}<img src="{{ qr_data_url }}" class="qr" />{% endif %}
    <div class="head clr">
      <p class="brand">Al Khamees Travel and Tourism</p>
      <p>Tel: (+965)1899777</p>
      <p>للإتصال أو واتساب</p>
    </div>

    <div class="st">Booking Details</div>
    <table>
      <tr><th>Booking Ref</th><td>{{ booking.booking_ref|default:"—" }}</td></tr>
      <tr class="full"><th>Voucher Code</th><td>{{ booking.voucher_code|default:"—" }}</td></tr>
      <tr><th>Date</th><td>{{ today|date:"d/m/Y" }}</td></tr>
      <tr><th>Employee</th><td>{{ booking.employee_name|default:"—" }}</td></tr>
      <tr><th>Provider</th><td>{{ booking.provider_name|default:"—" }}</td></tr>
    </table>

    <div class="st">Hotel Details</div>
    <table>
      <tr class="full"><th>Hotel Name</th><td>{{ booking.hotel_name|default:"—" }}</td></tr>
      <tr class="full"><th>Hotel Address</th><td>{{ booking.hotel_address|default:"—" }}</td></tr>
      <tr><th>Country</th><td>{{ booking.country|default:"—" }}</td></tr>
    </table>

    <div class="st">Accommodation</div>
    <table>
      <tr><th>Holder Name</th><td>{{ booking.customer_display_name|default:"—" }}</td></tr>
      <tr><th>Arrival date</th><td>{{ booking.checkin|date:"d/m/Y" }}</td></tr>
      <tr><th>Departure date</th><td>{{ booking.checkout|date:"d/m/Y" }}</td></tr>
      <tr><th>Nights</th><td>{{ booking.nights|default:"—" }}</td></tr>
      <tr><th>Rooms</th><td>{{ booking.rooms_count|default:"—" }}</td></tr>
      <tr><th>Board</th><td>{{ booking.meal_plan|default:"—" }}</td></tr>
      <tr class="full"><th>Room Type</th><td>{{ booking.room_type|default:"—" }}</td></tr>
    </table>

    <div class="st">Cancellation & Amendment</div>
    <table>
      <tr>
        <th>Policy</th>
        <td>
          {% if booking.cancellation_policy == 'refundable' %}
            refundable
          {% else %}
            non refundable non amendable
          {% endif %}
        </td>
      </tr>
      <tr>
        <th>Refundable until</th>
        <td>
          {% if booking.cancellation_policy == 'refundable' and booking.refundable_until %}
            {{ booking.refundable_until|date:"d/m/Y" }}
          {% else %}—{% endif %}
        </td>
      </tr>
      <tr class="full"><th>Cancellation Penalty</th><td>{{ booking.cancellation_penalty|default:"—" }}</td></tr>
    </table>

    <div class="st">Room & Guests</div>
    {% for num in "12345"|make_list %}
      {% with rn="room"|add:num|add:"_names" %}
        {% if forloop.counter <= booking.rooms_count %}
          <div class="gcard">
            <strong>Room {{ forloop.counter }}</strong>
            <table>
              <tr class="full"><th>Names</th><td>{{ booking|attr:rn|linebreaksbr|default:"—" }}</td></tr>
            </table>
          </div>
        {% endif %}
      {% endwith %}
    {% endfor %}
  </div>
</body>
</html>
